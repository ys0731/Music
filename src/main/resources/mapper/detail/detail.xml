<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org//dtd/mybatis-3-mapper.dtd">
<mapper namespace="detail">
	
	<!-- 앨범 상세-->
	<select id="albumDetail" parameterType="int" resultType="java.util.Map">
		SELECT
			s.genre,
			(SELECT artist FROM artist WHERE no=s.artist_no) AS artist,
			(SELECT album FROM album WHERE no=album_no) AS album,
    		(SELECT img_real FROM album WHERE no=album_no) AS album_img,
    		(SELECT reldate FROM album WHERE no=album_no) AS reldate,
            (SELECT info FROM album WHERE no=album_no) AS info,
            (SELECT no FROM album WHERE no=album_no) AS album_no
		FROM song AS s where album_no=#{album_no} GROUP BY album_no=#{album_no}
	</select>
	
	<!-- 아티스트 상세 -->
	<select id="artistDetail" parameterType="int" resultType="java.util.Map">
		SELECT no AS artist_no, artist, debdate, info, img_real FROM artist WHERE no=#{no}
	</select>
	
	<!-- 아티스트 검색 -->
	<select id="artistSearch" parameterType="String" resultType="java.util.Map">
		SELECT artist.no AS artist_no, artist, debdate, info, img_real, song.title AS title, song.album_no AS album_no
		FROM artist join song
		ON artist.no = song.artist_no
		WHERE artist.artist LIKE CONCAT('%',#{searchword},'%')
		GROUP BY artist.no;
	</select>
		
	<!--노래 검색  -->
	<select id="songSearch" parameterType="String" resultType="java.util.Map">
		SELECT song.no,artist_no,album_no,title,song.genre,lyrics,song.regdate,song.src_real,album.album,artist.artist,album.img_real
		FROM song JOIN album
		ON song.album_no = album.no
		JOIN artist
		ON song.artist_no = artist.no
        WHERE title LIKE CONCAT('%',#{searchword},'%')
        GROUP BY song.no;
	</select>	
	
	<!-- 앨범 상세 곡 -->
	<select id="albumSong" parameterType="int" resultType="java.util.Map">
		SELECT
			s.title,
			s.lyrics,
			(SELECT artist FROM artist WHERE no=s.artist_no) AS artist,
			(SELECT album FROM album WHERE no=album_no) AS album,
    		(SELECT img_real FROM album WHERE no=album_no) AS album_img
		FROM song AS s where album_no=#{album_no}
	</select>
	
	<!-- 아티스트 상세 곡-->
	<select id="artistSong" parameterType="int" resultType="java.util.Map">
		SELECT
			s.title,
			s.lyrics,
			(SELECT artist FROM artist WHERE no=s.artist_no) AS artist,
			(SELECT album FROM album WHERE no=album_no) AS album,
    		(SELECT img_real FROM album WHERE no=album_no) AS album_img
		FROM song AS s where artist_no=#{artist_no} ORDER BY s.regdate DESC
	</select>
	
</mapper>