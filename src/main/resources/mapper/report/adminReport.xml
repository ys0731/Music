<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org//dtd/mybatis-3-mapper.dtd">
<mapper namespace="adminreport">
	
	
	
	<!-- 목록 -->
	<select id="selectAll" resultType="music.admin.report.AdminReportVo" parameterType="music.admin.report.AdminReportVo">
		SELECT r.no,u.id,u.no AS user_no,alc.content AS al_words,arc.content AS ar_words,
		r.repdate,alc.no AS al_no, arc.no AS ar_no
		FROM report AS r
		LEFT JOIN user AS u ON r.user_no = u.no
		LEFT JOIN album_comment AS alc ON alc.no = r.album_co_no
		LEFT JOIN artist_comment AS arc ON arc.no = r.artist_co_no 
		ORDER BY repdate DESC
		LIMIT ${startIdx},${pageRow}
	</select>
	
	<!-- 상세 -->
	<select id="detail" resultType="music.admin.report.AdminReportVo" parameterType="music.admin.report.AdminReportVo">
		SELECT  r.no,u.id,u.no AS user_no,alc.content AS al_words,arc.content AS ar_words,
		r.repdate,alc.no AS al_no, arc.no AS ar_no
		FROM report AS r
		LEFT JOIN user AS u ON r.user_no = u.no
		LEFT JOIN album_comment AS alc ON alc.no = r.album_co_no
		LEFT JOIN artist_comment AS arc ON arc.no = r.artist_co_no 
		WHERE r.no = #{no}
	</select>
	
	<select id="count" resultType="int" parameterType="music.admin.report.AdminReportVo">
		SELECT COUNT(*) FROM report
	</select>
	
	<!-- 삭제 -->
	<delete id="delete" parameterType="music.admin.report.AdminReportVo">
		DELETE 
		FROM report
		WHERE album_co_no = #{al_no} AND artist_co_no = #{ar_no} AND user_no = #{user_no}			
		<!--  WHERE no = #{no}-->
	</delete>
	
	<!-- 신고 -->
	<insert id="insert" parameterType="music.admin.report.AdminReportVo">
		INSERT INTO report(user_no,repdate,
		<if test="al_no != 0">album_co_no</if>
		<if test="ar_no != 0">artist_co_no</if>)
		VALUES(#{user_no},NOW(),
		<if test="al_no != 0">#{al_no}</if>
		<if test="ar_no != 0">#{ar_no}</if>)
	</insert>
</mapper>